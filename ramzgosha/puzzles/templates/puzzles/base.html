<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ | Ù…Ø¹Ù…Ø§Ù‡Ø§ÛŒ Ú©Ù„Ù…Ø§ØªÛŒ</title>
    <link href="https://cdn.jsdelivr.net/npm/vazirmatn@33.0.0/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #1a1a2e; /* ØªÙ… Ø¯Ø§Ø±Ú© */
            color: #fff;
            margin: 0;
            padding: 0;
            /* ÙØ§ØµÙ„Ù‡ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ ØªØ§ Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ† Ú†ÛŒØ²ÛŒ Ø±Ùˆ Ù†Ù¾ÙˆØ´ÙˆÙ†Ù‡ */
            padding-bottom: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 90%;
            max-width: 600px;
            margin-top: 30px;
        }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ù‡Ø¯Ø± Ùˆ Ù„ÙˆÚ¯Ùˆ --- */
        .main-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(22, 33, 62, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            z-index: 9000;
            box-sizing: border-box;
        }
        .main-logo {
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù„ÙˆÚ¯ÙˆÛŒ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†ÛŒ Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ --- */
        .logo-box {
            background: #e94560;
            color: white;
            font-weight: bold;
            width: 24px;
            height: 28px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 4px;
            font-size: 1rem;
            /* ØªØ±Ø§Ù†Ø²ÛŒØ´Ù† Ø±Ùˆ Ø­Ø°Ù Ú©Ø±Ø¯ÛŒÙ… Ú†ÙˆÙ† Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø®ÙˆØ¯Ø´ Ú©Ø§Ø± Ø±Ùˆ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒØ¯Ù‡ */
        }

        /* Ø§Ø®ØªØµØ§Øµ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¨Ù‡ Ù‡Ø± Ø­Ø±Ù (9 Ø«Ø§Ù†ÛŒÙ‡ Ú©Ù„ Ú†Ø±Ø®Ù‡ Ø·ÙˆÙ„ Ù…ÛŒÚ©Ø´Ù‡) */
        .main-logo .logo-box:nth-child(1) { animation: animateR 9s infinite ease-in-out; } /* Ø­Ø±Ù Ø± */
        .main-logo .logo-box:nth-child(2) { animation: animateM 9s infinite ease-in-out; } /* Ø­Ø±Ù Ù… */
        .main-logo .logo-box:nth-child(3) { animation: animateZ 9s infinite ease-in-out; } /* Ø­Ø±Ù Ø² */

        /* * Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ:
         * 0% ØªØ§ 20%: Ø±Ù…Ø² (Ù‚Ø±Ù…Ø²)
         * 33% ØªØ§ 53%: Ù…Ø±Ø² (Ø²Ø±Ø¯)
         * 66% ØªØ§ 86%: Ø±Ø²Ù… (Ø¢Ø¨ÛŒ)
         */

        @keyframes animateR {
            0%, 20%   { transform: translateX(0); background: #e94560; color: white; }
            33%, 53%  { transform: translateX(-26px); background: #ffca28; color: #000; } /* Ù…ÛŒØ±Ù‡ Ø¬Ø§ÛŒ Ù… */
            66%, 86%  { transform: translateX(0); background: #e94560; color: white; } /* Ø¨Ø±Ù…ÛŒÚ¯Ø±Ø¯Ù‡ Ø³Ø± Ø¬Ø§Ø´ */
            100%      { transform: translateX(0); background: #e94560; color: white; }
        }

        @keyframes animateM {
            0%, 20%   { transform: translateX(0); background: #e94560; color: white; }
            33%, 53%  { transform: translateX(26px); background: #ffca28; color: #000; } /* Ù…ÛŒØ±Ù‡ Ø¬Ø§ÛŒ Ø± */
            66%, 86%  { transform: translateX(-26px); background: #4fc3f7; color: #000; } /* Ù…ÛŒØ±Ù‡ Ø¬Ø§ÛŒ Ø² */
            100%      { transform: translateX(0); background: #e94560; color: white; }
        }

        @keyframes animateZ {
            0%, 20%   { transform: translateX(0); background: #e94560; color: white; }
            33%, 53%  { transform: translateX(0); background: #e94560; color: white; } /* Ø³Ø± Ø¬Ø§Ø´ Ù…ÛŒÙ…ÙˆÙ†Ù‡ */
            66%, 86%  { transform: translateX(26px); background: #4fc3f7; color: #000; } /* Ù…ÛŒØ±Ù‡ Ø¬Ø§ÛŒ Ù… */
            100%      { transform: translateX(0); background: #e94560; color: white; }
        }

        .help-btn {
            cursor: pointer;
            background: rgba(79, 195, 247, 0.15);
            border: 1px solid #4fc3f7;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #4fc3f7;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background 0.2s;
        }
        .help-btn:hover { background: rgba(79, 195, 247, 0.3); }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ --- */
        .btn {
            background-color: #e0b0ff;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-family: inherit;
            font-size: 1rem;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.1s;
            box-shadow: 3px 3px 0px #000;
            border: 2px solid #000;
        }
        .btn:active { transform: translate(3px, 3px); box-shadow: none; }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ù†ÙˆØ§Ø± Ù†Ø§ÙˆØ¨Ø±ÛŒ Ù¾Ø§ÛŒÛŒÙ† (Bottom Nav) --- */
        .bottom-nav-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(30, 30, 50, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 12px;
            border-radius: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 9999;
            width: 90%;
            max-width: 500px;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #a0a0a0;
            font-size: 0.75rem;
            font-weight: 500;
            min-width: 60px;
            gap: 4px;
            transition: color 0.2s;
        }
        .nav-icon {
            font-size: 1.3rem;
            padding: 4px 18px;
            border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .nav-item.active { color: #fff; font-weight: 800; }
        .nav-item.active .nav-icon {
            background-color: #e0b0ff;
            color: #1a1a2e;
            transform: scale(1.1);
        }
        .nav-item:hover:not(.active) .nav-icon { background-color: rgba(255,255,255,0.1); }

        .modal-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10000; /* Ø±ÙˆÛŒ Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø­ØªÛŒ Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ† */
            justify-content: center; align-items: center;
            backdrop-filter: blur(3px);
        }
        .modal-box {
            background: #1a1a2e;
            border: 2px solid #fff;
            border-radius: 15px;
            padding: 20px;
            width: 90%; max-width: 450px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            max-height: 80vh;
            overflow-y: auto;
            text-align: right;
            direction: rtl;
        }
        .logout-btn {
            cursor: pointer;
            background: rgba(244, 67, 54, 0.15); /* Ù‚Ø±Ù…Ø² Ù…Ù„Ø§ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ */
            border: 1px solid #f44336;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #f44336;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background 0.2s;
            font-family: inherit;
        }
        .logout-btn:hover { background: rgba(244, 67, 54, 0.3); }

        @media (max-width: 400px) {
            .hide-text-mobile {
                display: none;
            }
            .help-btn, .logout-btn {
                padding: 5px 10px; /* Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ Ø¬Ù…Ø¹â€ŒÙˆØ¬ÙˆØ±ØªØ± Ù…ÛŒØ´Ù† */
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <a href="{% url 'home' %}" class="main-logo">
            <div style="display: flex; direction: rtl; gap: 2px;">
                <span class="logo-box">Ø±</span>
                <span class="logo-box">Ù…</span>
                <span class="logo-box">Ø²</span>
            </div>
            <span style="color: #fff; font-weight: 900; font-size: 1.2rem; margin-right: 5px;">Ú¯Ø´Ø§ÛŒÛŒ</span>
        </a>

        <div style="display: flex; gap: 10px; align-items: center;">

            <div class="help-btn" onclick="openHowToPlayModal()" title="Ú†Ú¯ÙˆÙ†Ù‡ Ø¨Ø§Ø²ÛŒ Ú©Ù†ÛŒÙ…ØŸ">
                <span>â“</span> <span class="hide-text-mobile">Ø±Ø§Ù‡Ù†Ù…Ø§</span>
            </div>

            {% if request.user.is_authenticated %}
            <form action="{% url 'logout' %}" method="post" style="margin: 0; padding: 0;">
                {% csrf_token %}
                <button type="submit" class="logout-btn" title="Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨">
                    <span>ğŸšª</span> <span class="hide-text-mobile">Ø®Ø±ÙˆØ¬</span>
                </button>
            </form>
            {% endif %}

        </div>
    </header>

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <div class="modal-overlay" id="howToPlayModal">
        <div class="modal-box">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; position: sticky; top: 0; background: #1a1a2e; z-index: 10;">
                <h3 style="margin:0; color: #e0b0ff;">Ú†Ú¯ÙˆÙ†Ù‡ Ø¨Ø§Ø²ÛŒ Ú©Ù†ÛŒÙ…ØŸ</h3>
                <span style="cursor: pointer; font-size: 1.5rem;" onclick="closeHowToPlayModal()">&times;</span>
            </div>

            <div style="font-size: 0.95rem; line-height: 1.8; color: #e0e0e0;">
                <p>Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ <strong>Cryptic Crosswords (Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø±Ù…ÙˆØ²)</strong> Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù‡Ø± Ù…Ø¹Ù…Ø§ ÛŒÚ© Ù¾Ø§Ø²Ù„ Ú©Ù„Ù…Ø§ØªÛŒ Ø¯ÙˆÚ¯Ø§Ù†Ù‡ Ø§Ø³Øª!</p>

                <h4 style="color: #4fc3f7; margin-bottom: 5px;">Û±. ØªØ¹Ø±ÛŒÙ (Definition)</h4>
                <p style="margin-top: 0;">ÛŒÚ© Ù‚Ø³Ù…Øª Ø§Ø² Ø¬Ù…Ù„Ù‡ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù‡Ù…â€ŒÙ…Ø¹Ù†ÛŒ Ú©Ù„Ù…Ù‡ Ù¾Ø§Ø³Ø® Ø§Ø³Øª.</p>

                <h4 style="color: #ffb300; margin-bottom: 5px;">Û². Ù…ØµØ§Ù„Ø­ (Fodder)</h4>
                <p style="margin-top: 0;">Ø¨Ø®Ø´ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø² Ø¬Ù…Ù„Ù‡ØŒ Ø­Ø±ÙˆÙ Ú©Ù„Ù…Ù‡ Ù¾Ø§Ø³Ø® Ø±Ø§ Ø¯Ø± Ø®ÙˆØ¯ Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª.</p>

                <h4 style="color: #f06292; margin-bottom: 5px;">Û³. Ù†Ø´Ø§Ù†Ú¯Ø±Ù‡Ø§ (Indicators)</h4>
                <p style="margin-top: 0;">Ú©Ù„Ù…Ø§ØªÛŒ Ú©Ù‡ Ù…Ø«Ù„ Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„ Ù…ÛŒâ€ŒÚ¯ÙˆÛŒÙ†Ø¯ Ø¨Ø§ Â«Ù…ØµØ§Ù„Ø­Â» Ú†Ù‡ Ú©Ø§Ø± Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ Ø­Ø±ÙˆÙ Ø±Ø§ Ø¨Ù‡ Ù‡Ù… Ø¨Ø±ÛŒØ²).</p>

                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 20px 0; border-right: 3px solid #e94560;">
                    <strong style="color: #fff;">Ù…Ø«Ø§Ù„:</strong><br>
                    <em>Ø±ÙˆÛŒ Ø¢Ù† Ù†ÙˆØ´Øª: Ø¨Ø§ Ú¯Ø±Ø¨Ù‡ Ù‡Ø± Ú©Ø§Ø± Ù…ÛŒØ®ÙˆØ§Ù‡ÛŒ Ø¨Ú©Ù†.</em><br>
                    - <strong>Ù¾Ø§Ø³Ø®:</strong> Ø¨Ø±Ú¯Ù‡<br>
                    - <span style="color: #4fc3f7;">Ø±ÙˆÛŒ Ø¢Ù† Ù†ÙˆØ´Øª</span> (ØªØ¹Ø±ÛŒÙ)<br>
                    - <span style="color: #ffb300;">Ú¯Ø±Ø¨Ù‡</span> (Ù…ØµØ§Ù„Ø­: Ø­Ø±ÙˆÙÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒÙ…)<br>
                    - <span style="color: #f06292;">Ù‡Ø± Ú©Ø§Ø± Ù…ÛŒØ®ÙˆØ§Ù‡ÛŒ Ø¨Ú©Ù†</span> (Ù†Ø´Ø§Ù†Ú¯Ø±: Ø­Ø±ÙˆÙ Ø±Ø§ Ø¨Ù‡ Ù‡Ù… Ø¨Ø±ÛŒØ²)
                </div>

                <p>Ø§Ú¯Ø± Ú¯ÛŒØ± Ø§ÙØªØ§Ø¯ÛŒØ¯ØŒ Ø§Ø² Ø¯Ú©Ù…Ù‡ <strong>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ ğŸ’¡</strong> Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
            </div>

            <div style="margin-top: 30px; border-top: 1px dashed #555; padding: 15px 0; text-align: center; font-size: 0.85rem; color: #a0a0a0;">
                <p style="margin: 5px 0;">Ø·Ø±Ø§Ø­ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡ Ø¨Ø§ â¤ï¸</p>
                <p style="margin: 0;">Developed by <a href="https://github.com/mahdiosm" target="_blank" style="color: #4fc3f7; text-decoration: none; font-weight: bold;">mahdiosm</a></p>
            </div>
        </div>
    </div>

    <nav class="bottom-nav-container">
        {% url 'home' as url_home %}
        <a href="{{ url_home }}" class="nav-item {% if request.path == url_home %}active{% endif %}">
            <div class="nav-icon">ğŸ§©</div>
            <span>Ø§Ù…Ø±ÙˆØ²</span>
        </a>

        {% url 'archive_calendar' as url_calendar %}
        <a href="{{ url_calendar }}" class="nav-item {% if '/archive/calendar' in request.path %}active{% endif %}">
            <div class="nav-icon">ğŸ“…</div>
            <span>ØªÙ‚ÙˆÛŒÙ…</span>
        </a>

        {% url 'create_puzzle' as url_create %}
        <a href="{{ url_create }}" class="nav-item {% if request.path == url_create %}active{% endif %}">
            <div class="nav-icon">â•</div>
            <span>Ø·Ø±Ø§Ø­ÛŒ</span>
        </a>

        {% if request.user.is_authenticated %}
            {% url 'my_puzzles' as url_my_puzzles %}
            <a href="{{ url_my_puzzles }}" class="nav-item {% if request.path == url_my_puzzles %}active{% endif %}">
                <div class="nav-icon">ğŸ‘¤</div>
                <span>Ù¾Ø±ÙˆÙØ§ÛŒÙ„</span>
            </a>
        {% else %}
            {% url 'login' as url_login %}
            <a href="{{ url_login }}" class="nav-item {% if request.path == url_login %}active{% endif %}">
                <div class="nav-icon">ğŸšª</div>
                <span>ÙˆØ±ÙˆØ¯</span>
            </a>
        {% endif %}

        {% if request.user.is_staff %}
            {% url 'admin_review_puzzles' as url_admin %}
            <a href="{{ url_admin }}" class="nav-item {% if request.path == url_admin %}active{% endif %}">
                <div class="nav-icon">ğŸ›¡ï¸</div>
                <span>Ù…Ø¯ÛŒØ±ÛŒØª</span>
            </a>
        {% endif %}
    </nav>

    <script>
        // Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…ÙˆØ¯Ø§Ù„ Ø¢Ù…ÙˆØ²Ø´ Ø¯Ø± Ú©Ù„ Ø³Ø§ÛŒØª
        window.openHowToPlayModal = function() {
            document.getElementById('howToPlayModal').style.display = 'flex';
        }
        window.closeHowToPlayModal = function() {
            document.getElementById('howToPlayModal').style.display = 'none';
        }
        document.getElementById('howToPlayModal').addEventListener('click', function(e) {
            if (e.target === this) { closeHowToPlayModal(); }
        });
    </script>

<script>
        document.addEventListener("DOMContentLoaded", function() {
            const englishNumbers = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];
            const persianNumbers = ["Û°", "Û±", "Û²", "Û³", "Û´", "Ûµ", "Û¶", "Û·", "Û¸", "Û¹"];

            function convertToPersian(node) {
                // Ø§Ú¯Ø± Ù…ØªÙ† Ø®Ø§Ù… Ø¨ÙˆØ¯ØŒ Ø§Ø¹Ø¯Ø§Ø¯Ø´ Ø±Ùˆ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†
                if (node.nodeType === 3) {
                    let text = node.nodeValue;
                    for (let i = 0; i < 10; i++) {
                        text = text.split(englishNumbers[i]).join(persianNumbers[i]);
                    }
                    node.nodeValue = text;
                }
                // Ø§Ú¯Ø± ØªÚ¯ HTML Ø¨ÙˆØ¯ØŒ Ø¨Ø±Ùˆ Ø¯Ø§Ø®Ù„Ø´ (ÙˆÙ„ÛŒ Ú©Ø§Ø±ÛŒ Ø¨Ù‡ Ø§ÛŒÙ†Ù¾ÙˆØªâ€ŒÙ‡Ø§ Ùˆ Ú©Ø¯Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´)
                else if (node.nodeType === 1 && !['SCRIPT', 'STYLE', 'INPUT', 'TEXTAREA'].includes(node.tagName)) {
                    for (let i = 0; i < node.childNodes.length; i++) {
                        convertToPersian(node.childNodes[i]);
                    }
                }
            }
            // Ø§Ø¬Ø±Ø§ÛŒ ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ú©Ù„ ØµÙØ­Ù‡
            convertToPersian(document.body);
        });
    </script>
</body>
</html>